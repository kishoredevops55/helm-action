ignore_files:
  # Ignore everything by default
  - "*"
  # Allow only these folders and their contents
  - "!helm/**"
  - "!helmchart/**"
  - "!helmchart*/**"

ignore_charts:
  # Ignore all charts except those in allowed folders
  - "*"
  - "!helm"
  - "!helmchart"
  - "!helmchart*"

ignore_variables:
  # Variables to skip during validation
  - debugMode
  - temporaryFlag
  - testAnnotation


rules:
  # ENVIRONMENT RULES
  # - id: ENV_PROD
  #   enabled: true
  #   description: "Production files must not contain {value} references"
  #   severity: critical
  #   category: environment
  #   env_match: ["prod"]
  #   patterns: ["\\bdev\\b", "\\bqa\\b", "\\bstage\\b", "\\btest\\b", "\\bnonprod\\b", "\\bperf\\b", "\\bperf1\\b"]
  #   suggestion: "Remove {value} references from prod values."
  #   action: "Replace {value} with proper prod values."
  - id: ENV_PROD_NONPROD_REF
    enabled: true
    description: "Production files must not contain {value} references"
    severity: critical
    category: environment
    env_match: ["prod"]
    patterns:
      # Forbidden environments — easily extendable
      - "(?i).*dev.*"
      - "(?i).*qa.*"
      - "(?i).*perf.*"
      - "(?i).*perf1.*"
      - "(?i).*nonprod.*"
    suggestion: "Remove {value} references from prod values."
    action: "Replace {value} with proper prod values."


  - id: ENV_DEV
    enabled: true
    description: "Dev files must not contain {value} references"
    severity: high
    category: environment
    env_match: ["dev"]
    patterns: 
      # Forbidden environments — easily extendable
      - "(?i).*prod.*"
      - "(?i).*qa.*"
      - "(?i).*perf.*"
      - "(?i).*perf1.*"
      - "(?i).*nonprod.*"
    suggestion: "Remove {value} references from dev values."
    action: "Move {value} config to prod-specific files."

  - id: ENV_STAGE_PROD_REF
    enabled: true
    description: "Stage files must not contain {value} references"
    severity: high
    category: environment
    env_match: ["stage"]
    patterns:
      - "(?i).*prod.*"
      - "label:\\s*.*prod"
      - "name:\\s*.*prod"
      - "annotation:\\s*.*prod"
      - "ENV.*prod.*"
      - "config.*prod.*"
    suggestion: "Remove {value} references from stage values."
    action: "Move {value} config to prod-specific files."

  - id: ENV_QA_PROD_REF
    enabled: true
    description: "QA files must not contain {value} references"
    severity: high
    category: environment
    env_match: ["qa"]
    patterns:
      - "(?i).*prod.*"
      - "label:\\s*.*prod"
      - "name:\\s*.*prod"
      - "annotation:\\s*.*prod"
      - "ENV.*prod.*"
      - "config.*prod.*"
    suggestion: "Remove {value} references from QA values."
    action: "Move {value} config to prod-specific files."

  - id: ENV_NONPROD_PROD_REF
    enabled: true
    description: "Nonprod files must not contain {value} references"
    severity: high
    category: environment
    env_match: ["nonprod"]
    patterns:
      - "(?i).*prod.*"
      - "label:\\s*.*prod"
      - "name:\\s*.*prod"
      - "annotation:\\s*.*prod"
      - "ENV.*prod.*"
      - "config.*prod.*"
    suggestion: "Remove {value} references from nonprod values."
    action: "Move {value} config to prod-specific files."

  - id: ENV_PERF_PROD_REF
    enabled: true
    description: "Perf files must not contain {value} references"
    severity: high
    category: environment
    env_match: ["perf"]
    patterns:
      - "(?i).*prod.*"
      - "label:\\s*.*prod"
      - "name:\\s*.*prod"
      - "annotation:\\s*.*prod"
      - "ENV.*prod.*"
      - "config.*prod.*"
    suggestion: "Remove {value} references from perf values."
    action: "Move {value} config to prod-specific files."

  - id: ENV_PERF1_PROD_REF
    enabled: true
    description: "Perf1 files must not contain {value} references"
    severity: high
    category: environment
    env_match: ["perf1"]
    patterns:
      - "(?i).*prod.*"
      - "label:\\s*.*prod"
      - "name:\\s*.*prod"
      - "annotation:\\s*.*prod"
      - "ENV.*prod.*"
      - "config.*prod.*"
    suggestion: "Remove {value} references from perf1 values."
    action: "Move {value} config to prod-specific files."


  # CLOUD RULES
  - id: CLOUD_AKS
    enabled: true
    description: "AKS files must not contain {value} references"
    severity: critical
    category: cloud
    env_match: ["aks"]
    patterns:
      - "(?i).*gke.*"
      - "(?i).*gcp.*"
      - "(?i).*google.*"
      - "(?i).*aws.*"
      - "(?i).*eks.*"
    suggestion: "Remove {value} references from AKS configuration."
    action: "Split {value} config into GKE/AWS-specific files."

  - id: CLOUD_GKE
    enabled: true
    description: "GKE files must not contain {value} references"
    severity: critical
    category: cloud
    env_match: ["gke", "gcp"]
    patterns:
      - "(?i).*aks.*"
      - "(?i).*azure.*"
      - "(?i).*aws.*"
      - "(?i).*eks.*"
    suggestion: "Remove {value} references from GKE configuration."
    action: "Split {value} config into AKS/AWS-specific files."

  - id: CLOUD_AWS
    enabled: true
    description: "AWS files must not contain {value} references"
    severity: critical
    category: cloud
    env_match: ["aws", "eks"]
    patterns:
      - "(?i).*aks.*"
      - "(?i).*azure.*"
      - "(?i).*gke.*"
      - "(?i).*gcp.*"
    suggestion: "Remove {value} references from AWS configuration."
    action: "Split {value} config into AKS/GKE-specific files."

  # REGION RULES
  - id: REGION_EAST
    enabled: true
    description: "East region files must not contain {value} region references"
    severity: high
    category: region
    env_match: ["east", "eastus", "eu", "uw4"]
    patterns:
      - "(?i).*west.*"
      - "(?i).*wu.*"
      - "(?i).*uw2.*"
      - "(?i).*westus.*"
    suggestion: "Remove {value} references from east region configuration."
    action: "Move {value} config to west-specific files."

  - id: REGION_WEST
    enabled: true
    description: "West region files must not contain {value} region references"
    severity: high
    category: region
    env_match: ["west", "westus", "wu", "uw2"]
    patterns:
      - "(?i).*east.*"
      - "(?i).*eu.*"
      - "(?i).*uw4.*"
      - "(?i).*eastus.*"
    suggestion: "Remove {value} references from west region configuration."
    action: "Move {value} config to east-specific files."

  # IMAGE TAG RULES
  - id: IMAGE_TAG_NESTED
    enabled: true
    description: "Image tag {value} is not allowed in nested format"
    severity: critical
    category: image
    env_match: ["all"]
    patterns:
      - "tag:\\s*(?!prod-v|v.*-RELEASE|v.*-SNAPSHOT)[^\\s]+"
    suggestion: "Use approved image tags like prod-v.*, v.*-RELEASE, or v.*-SNAPSHOT."
    action: "Update image tag to match approved formats."

  # RESOURCE RULES
  - id: RES_CPU_PROD
    enabled: true
    description: "CPU value {value} is below production threshold"
    severity: critical
    category: resource
    env_match: ["prod"]
    patterns:
      - "cpu:\\s*(?![5-9][0-9]{2,}m|[1-9][0-9]*000m)\\d+m"
    suggestion: "Use CPU >= 500m for production workloads."
    action: "Update CPU request to meet production standards."

  - id: RES_MEM_PROD
    enabled: true
    description: "Memory value {value} is below production threshold"
    severity: critical
    category: resource
    env_match: ["prod"]
    patterns:
      - "memory:\\s*(?![5-9][1-9]{2,}Mi|[1-9][0-9]{3,}Mi)\\d+Mi"
    suggestion: "Use memory >= 512Mi for production workloads."
    action: "Update memory request to meet production standards."

  # REPLICA RULES
  - id: REPLICA_DEV
    enabled: true
    description: "Dev replica count {value} exceeds allowed limit"
    severity: medium
    category: scaling
    env_match: ["dev"]
    patterns:
      - "replicaCount:\\s*(?:[3-9]|[1-9][0-9]{2,})"
    suggestion: "Use replicaCount <= 2 for dev."
    action: "Reduce replica count to save resources."

  - id: REPLICA_PROD
    enabled: true
    description: "Production replica count {value} is below required minimum"
    severity: critical
    category: scaling
    env_match: ["prod"]
    patterns:
      - "replicaCount:\\s*[01]"
    suggestion: "Use replicaCount >= 2 for production."
    action: "Increase replica count for high availability."

  # KUBERNETES POLICIES
  - id: K8S_API_VERSION
    enabled: true
    description: "Kubernetes API version {value} is deprecated"
    severity: critical
    category: kubernetes
    env_match: ["all"]
    patterns:
      - "apiVersion:\\s*extensions/v1beta1"
      - "apiVersion:\\s*apps/v1beta1"
    suggestion: "Use stable API versions like apps/v1."
    action: "Update apiVersion to supported Kubernetes versions."

  - id: K8S_NODEPOOL_LABEL
    enabled: true
    description: "Node pool label {value} is missing or empty"
    severity: high
    category: kubernetes
    env_match: ["all"]
    patterns:
      - "nodeSelector:\\s*\\{\\s*\\}"
    suggestion: "Define nodeSelector labels for workload placement."
    action: "Set nodeSelector to target appropriate node pool."

  # METADATA RULES
  - id: METADATA_DR_CATEGORY
    enabled: true
    description: "drCategory value {value} is not allowed"
    severity: critical
    category: metadata
    env_match: ["all"]
    patterns:
      - "drCategory:\\s*(?!dr3\\b|\\*?drCategory\\b|&?drCategory\\b)[^\\s]+"
    suggestion: "Set drCategory to dr3 or use approved anchor."
    action: "Update drCategory to dr3 for compliance or reference."


  - id: METADATA_COST_CENTER
    enabled: true
    description: "costCenter value {value} is not allowed"
    severity: critical
    category: metadata
    env_match: ["all"]
    patterns:
      - "costCenter:\\s*(?!9901623\\b|\\*?costCenter\\b|&?costCenter\\b)[^\\s]+"
    suggestion: "Set costCenter to 9901623 or use approved anchor."
    action: "Update costCenter to match approved value or reference."


  - id: METADATA_PORTFOLIO
    enabled: true
    description: "Portfolio value {value} is not allowed"
    severity: high
    category: metadata
    env_match: ["all"]
    patterns:
      - "portfolio:\\s*(?!Observability\\*?portfolio\\b|&?portfolio\\b)[^\\s]+"
    suggestion: "Set portfolio to Observability or Devops, or use approved anchor."
    action: "Remove invalid portfolio value and use approved options or reference."

